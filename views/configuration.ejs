<script src="/hooks/xiaomi-home/js/xiaomi.config.js"></script>
<script src="/hooks/xiaomi-home/js/xiaomi.controller.js"></script>
<script src="/hooks/xiaomi-home/js/xiaomi.service.js"></script>

<div data-ng-controller="xiaomiCtrl as vm">
  <div class="row ng-cloak">
    <div class="col-centered col-md-6">
      <div class="box box-widget widget-user-2 card grid-item">
        <div class="box-header with-border">
          <h3 class="widget-user-username">{{ 'GATEWAY' | translate }}</h3>
        </div>
        <div class="box-body table-responsive">
          <table class="table table-striped ng-cloak">
            <thead>
              <tr>
                <th>
                  {{ 'IDENTIFIER' | translate }}
                </th>
                <th>
                  {{ 'IP' | translate }}
                </th>
                <th>
                  {{ 'PASSWORD' | translate }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="gateway in vm.gateways" class="ng-cloak">
                <td style="vertical-align:middle">
                  {{gateway.sid}}
                </td>
                <td style="vertical-align:middle">
                  {{gateway.ip}}
                </td>
                <td>
                  <input type="text" ng-model="gateway.password" class="form-control" ng-style="{'background-color': (!gateway.validKey) ? 'rgb(226,139,129)' : '#fff'}" />
                </td>
              </tr>
              <tr ng-show="vm.gatewaysCount == 0">
                <td colspan="3" style="text-align:center" class="text-red">
                  {{ 'NO_GATEWAY' | translate }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
      <div class="box-footer">
        <button class="btn btn-flat btn-primary" ng-click="vm.refresh()"><i class="fa fa-refresh"></i> {{ 'REFRESH' |
          translate }}</button>
        <button class="btn btn-flat btn-primary" ng-click="vm.savePassword()"><i class="fa fa-save"></i> {{ 'SAVE' |
          translate }}</button>
      </div>
      <div>
        {{ 'GATEWAY_TEXT_1' | translate }}<br />
        {{ 'GATEWAY_TEXT_2' | translate }}<br />
        {{ 'GATEWAY_TEXT_3' | translate }}<br />
        {{ 'GATEWAY_TEXT_4' | translate }}<br />
        {{ 'GATEWAY_TEXT_5' | translate }}
      </div>
    </div>
    <div class="col-centered col-md-3">
      <div class="box box-widget widget-user-2 card grid-item">
        <div class="box-header with-border">
          <h3 class="widget-user-username">{{ 'UNCREATED_DEVICE' | translate }}</h3>
        </div>
        <div class="box-body table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>
                  {{ 'IDENTIFIER' | translate }}
                </th>
                <th>
                  {{ 'MODEL' | translate }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="uncreated in vm.uncreated" class="ng-cloak">
                <td>
                  {{uncreated.sid}}
                </td>
                <td>
                  {{uncreated.model}}
                </td>
              </tr>
              <tr ng-show="vm.uncreatedCount == 0">
                <td colspan="3" style="text-align:center" class="text-green">
                  {{ 'NO_UNCREATED' | translate }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div>
        {{ 'UNCREATED_TEXT_1' | translate }}<br />
        {{ 'UNCREATED_TEXT_2' | translate }}<br />
        {{ 'UNCREATED_TEXT_3' | translate }}<br />
        {{ 'UNCREATED_TEXT_4' | translate }}
      </div>
    </div>
    <div class="col-centered col-md-3">
      <div class="box box-widget widget-user-2 card grid-item">
        <div class="box-header with-border">
          <h3 class="widget-user-username">{{ 'UNKNOWN_DEVICE' | translate }}</h3>
        </div>
        <div class="box-body table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>
                  {{ 'IDENTIFIER' | translate }}
                </th>
                <th>
                  {{ 'MODEL' | translate }}
                </th>
                <th>
                  {{ 'SELECTED' | translate }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="unknown in vm.unknown" class="ng-cloak">
                <td>
                  {{unknown.sid}}
                </td>
                <td>
                  {{unknown.model}}
                </td>
                <td><input type="radio" name="radio" id="optionsRadios" value="value" ng-click="vm.unknownDevice = unknown"></td>
              </tr>
              <tr ng-show="vm.unknownCount == 0">
                <td colspan="3" style="text-align:center" class="text-green">
                  {{ 'NO_UNKNOWN' | translate }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="box-footer">
        <button ng-if="!vm.unknownReady" class="btn btn-flat btn-primary" data-toggle="modal" data-target=".xiaomi-logUnknownModal" ng-click="vm.logUnknownStart()"><i
            class="fa fa-file-text"></i> {{ 'SHOW_LOG' |
            translate }}</button>
      </div>
      <div>
        {{ 'UNKNOWN_TEXT_1' | translate }}<br />
        {{ 'UNKNOWN_TEXT_2' | translate }} <a href="{{ 'GITHUB_README' | translate }}" target=_blank>{{ 'UNKNOWN_TEXT_3'
          | translate }}</a>
      </div>
    </div>
  </div>
  <div class="modal fade xiaomi-logUnknownModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">{{vm.unknownDevice.model}}</h4>
        </div>
        <div class="modal-body">
          <pre style="height:370px"><code id="idUnknownLog">{{vm.logUnknown}}</code></pre>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger btn-flat" data-dismiss="modal" ng-click="vm.logUnknownStop()">STOP</button>
        </div>
      </div>
    </div>
  </div>


</div>